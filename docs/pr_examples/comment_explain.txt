# PR Comment: Explain Phase

**ğŸ’¡ CostPilot Explanation**

CostPilot has analyzed the root causes of your cost increase and traced the impact across your infrastructure.

## Why Costs Increased

### ğŸ¯ Root Cause Analysis

**1. EC2 Instance Type Change** (`main.tf:42`)
```hcl
- instance_type = "t3.micro"   # 2 vCPU, 1 GiB RAM
+ instance_type = "t3.xlarge"  # 4 vCPU, 16 GiB RAM
```

**Why this matters:**
- This change affects **every instance** in the autoscaling group
- Autoscaling group runs 3-10 instances (average: 5)
- Unit cost increase: $0.0104/hr â†’ $0.1664/hr (16x more expensive)
- **Cascading impact**: ALB distributes traffic to all instances

**Cost propagation path:**
```
ec2_instance_type â†’ autoscaling_group â†’ alb_target_group â†’ alb â†’ monthly_bill
```

---

**2. S3 Lifecycle Policy Disabled** (`main.tf:87`)
```hcl
  lifecycle_rule {
-   enabled = true
+   enabled = false
  }
```

**Why this matters:**
- Data previously deleted after 30 days now stored indefinitely
- Current growth: ~16GB/day
- Without lifecycle: 500GB accumulates per month
- Storage cost: $0.023/GB/month Ã— 500GB = $11.50/month (compounding)

---

**3. CloudWatch Log Retention Extended** (`main.tf:156`)
```hcl
- retention_in_days = 30
+ retention_in_days = 0  # infinite retention
```

**Why this matters:**
- Application generates ~10GB logs/day
- 30-day retention: 300GB stored
- Infinite retention: 300GB â†’ 600GB â†’ 900GB (growing monthly)
- First-month increase: +50% log volume (+$6), accumulates over time

---

## Dependencies Visualized

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ALB (no change)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Target Group    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Autoscaling Group   â”‚â—„â”€â”€â”€â”€â”€â”‚ Launch Template  â”‚
â”‚ (3-10 instances)    â”‚      â”‚ (instance type)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â–²
         â”‚                            â”‚
         â–¼                     *** CHANGE HERE ***
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       t3.micro â†’ t3.xlarge
â”‚ EC2 Instances       â”‚       (+1500% cost)
â”‚ Cost: $476.70/month â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Business Impact

**If merged without changes:**
- Current monthly AWS spend: ~$57/month
- After PR: ~$609/month
- Annual impact: **+$6,600/year**

**Performance justification needed:**
- Does the workload require 16 GiB RAM? (Currently using ~512 MB)
- Is 4 vCPU necessary? (Current CPU utilization: 15%)

---

**ğŸ”§ Recommended Actions:**
1. Change to `t3.small` instead (2 vCPU, 2 GiB) â†’ Saves $400/month
2. Re-enable S3 lifecycle policy â†’ Saves $45/month
3. Set log retention to 90 days (compliance) â†’ Saves $8/month

---
*Generated by CostPilot v1.0.0 | [Learn more](https://github.com/costpilot)*
