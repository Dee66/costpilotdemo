ğŸ¤– **CostPilot Analysis â€” PR #42**

**Branch**: `feature/upgrade-instances` â†’ `main`  
**Baseline**: `infrastructure/terraform/baseline/`  
**PR Stack**: `infrastructure/terraform/pr-change/`

---

## ğŸ” Detection Summary

**4 cost-impacting changes detected**
- ğŸ”´ High Severity: **2**
- ğŸŸ¡ Medium Severity: **2**
- ğŸ”µ Low Severity: **0**

---

### ğŸ”´ Finding 1: EC2 Instance Type Upgrade (HIGH)

**Resource**: `aws_launch_template.main`  
**Change**: `instance_type`  
- **Before**: `t3.micro` (2 vCPU, 1GB RAM)
- **After**: `t3.xlarge` (4 vCPU, 16GB RAM)

**Impact**: 16x cost increase per instance  
**Rule IDs**:
- `ec2-instance-type-change`
- `compute-cost-regression`
- `policy:default-ec2-type` âš ï¸ **Policy Violation**

**Rationale**: Instance type upgrade represents significant cost increase. Violates organizational policy 'default-ec2-type' which mandates t3.micro for cost efficiency unless exemption is documented.

---

### ğŸ”´ Finding 2: S3 Lifecycle Disabled (HIGH)

**Resource**: `aws_s3_bucket_lifecycle_configuration.main`  
**Change**: Resource **deleted**

**Impact**: Lifecycle rules removed â†’ objects never expire â†’ storage costs compound indefinitely  
**Rule IDs**:
- `s3-lifecycle-disabled`
- `storage-cost-regression`

**Rationale**: Removing lifecycle rules means objects accumulate indefinitely. For a bucket receiving daily logs/analytics data, this results in exponential storage cost growth over time.

---

### ğŸŸ¡ Finding 3: EBS Volume Size Increase (MEDIUM)

**Resource**: `aws_launch_template.main`  
**Change**: `block_device_mappings[0].ebs.volume_size`
- **Before**: `20 GB`
- **After**: `200 GB`

**Impact**: 10x storage capacity increase per instance  
**Rule IDs**:
- `ebs-volume-size-increase`
- `storage-cost-regression`

**Rationale**: Volume size increased from 20GB to 200GB (10x). With 2+ instances, this significantly increases EBS storage costs.

---

### ğŸŸ¡ Finding 4: CloudWatch Log Retention Infinite (MEDIUM)

**Resource**: `aws_cloudwatch_log_group.main`  
**Change**: `retention_in_days`
- **Before**: `30 days`
- **After**: `0` (infinite retention)

**Impact**: Long-term storage cost accumulation  
**Rule IDs**:
- `cloudwatch-log-retention-infinite`
- `observability-cost-regression`

**Rationale**: Setting retention to 0 means logs are kept indefinitely. CloudWatch charges for log storage, so this creates unbounded cost growth as logs accumulate over months/years.

---

## ğŸ“Š Cross-Service Dependencies

The changes in this PR create cascading cost impacts:

```
ALB â†’ Target Group â†’ Auto Scaling Group â†’ EC2 Instances (t3.xlarge)
                                           â”œâ”€ EBS Volumes (200GB each)
                                           â””â”€ CloudWatch Logs (infinite retention)

S3 Bucket (no lifecycle) â† Analytics Data â† Daily Uploads
```

**Key Risk**: The instance type change affects multiple resources in the auto-scaling group, multiplying the per-instance cost increase.

---

## ğŸ¯ Next Steps

1. **Review Policy Violation**: The t3.xlarge upgrade violates `default-ec2-type` policy
   - Document business justification for larger instance type
   - Or revert to t3.micro (see auto-fix suggestions below)

2. **Review Storage Changes**: Both S3 lifecycle removal and EBS size increase need justification

3. **See Cost Prediction**: Review `comment_predict.txt` for detailed monthly cost impact

4. **Apply Auto-Fixes**: See `comment_autofix.txt` for suggested code changes

---

âš™ï¸ **CostPilot v1.0.0** | Scenario v1 | Analysis completed in 180ms  
ğŸ“Š [View Detailed Analysis](#) | ğŸ”§ [Auto-Fix Suggestions](#)
